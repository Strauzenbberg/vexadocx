<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>VEXA DOCX — OCR PDF para Word</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="VEXA DOCX — Converta PDFs escaneados em arquivos Word com OCR inteligente. 100% online.">

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f9fafb;
  color: #111;
  margin: 0;
  padding: 0;
}

header {
  background: #111827;
  color: #fff;
  padding: 20px;
  text-align: center;
}

main {
  max-width: 800px;
  margin: 40px auto;
  padding: 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
}

input[type="file"] {
  margin-bottom: 20px;
}

button {
  background: #111827;
  color: #fff;
  border: none;
  padding: 12px 20px;
  font-size: 14px;
  border-radius: 6px;
  cursor: pointer;
}

button:disabled {
  background: #9ca3af;
}

#log {
  background: #000;
  color: #0f0;
  padding: 12px;
  height: 160px;
  overflow-y: auto;
  font-size: 12px;
  margin-top: 20px;
  border-radius: 6px;
}

#progressContainer {
  width: 100%;
  background: #e5e7eb;
  border-radius: 6px;
  margin-top: 15px;
  overflow: hidden;
  display: none;
}

#progressBar {
  width: 0%;
  height: 12px;
  background: #16a34a;
  transition: width .3s;
}

footer {
  margin-top: 60px;
}
</style>
</head>

<body>

<header>
  <h1>VEXA DOCX</h1>
  <p>OCR profissional — PDF escaneado para Word</p>
</header>

<main>

<input type="file" id="pdfInput" accept="application/pdf">
<br>
<button id="startBtn">Converter para DOCX</button>

<div id="progressContainer">
  <div id="progressBar"></div>
</div>

<div id="log"></div>

</main>

<!-- ===============================
     APOIO AO PROJETO VEXA (PIX)
================================= -->
<footer>

<section style="
    max-width: 720px;
    margin: 0 auto 40px;
    padding: 24px;
    border-top: 1px solid #e5e7eb;
    text-align: center;
">

<h2>Apoie o VEXA ❤️</h2>

<p style="color:#444; line-height:1.6;">
Este projeto é mantido de forma independente.<br>
Se o <strong>VEXA</strong> economizou seu tempo, considere apoiar com uma doação via Pix.<br>
Isso mantém a ferramenta <strong>gratuita para todos</strong>.
</p>

<button onclick="copiarPix()">Apoiar o VEXA ❤️</button>

<input id="pixKey" type="text"
value="153d672d-9acb-4fc9-90b9-42ad3a097709"
style="position:absolute;left:-9999px;">

<p id="pixStatus" style="display:none;color:#16a34a;margin-top:10px;">
✅ Chave Pix copiada!
</p>

</section>

</footer>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';

const log = msg => {
  document.getElementById("log").innerHTML += msg + "<br>";
};

const progressBar = document.getElementById("progressBar");
const progressContainer = document.getElementById("progressContainer");

document.getElementById("startBtn").onclick = async () => {
  const file = document.getElementById("pdfInput").files[0];
  if (!file) return alert("Selecione um PDF.");

  log("> Sistema pronto");
  log("> Carregando PDF...");

  progressContainer.style.display = "block";
  progressBar.style.width = "0%";

  const pdfData = new Uint8Array(await file.arrayBuffer());
  const pdf = await pdfjsLib.getDocument(pdfData).promise;

  log(`> PDF com ${pdf.numPages} páginas`);

  const paragraphs = [];
  const totalPages = pdf.numPages;

  for (let i = 1; i <= totalPages; i++) {
    log(`> OCR página ${i}/${totalPages}`);

    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 2 });
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({ canvasContext: ctx, viewport }).promise;

    const { data: { text } } = await Tesseract.recognize(
      canvas,
      "por",
      { logger: () => {} }
    );

    paragraphs.push(new docx.Paragraph(text));

    progressBar.style.width = `${Math.round((i / totalPages) * 100)}%`;
  }

  const doc = new docx.Document({
    sections: [{ children: paragraphs }]
  });

  const blob = await docx.Packer.toBlob(doc);
  saveAs(blob, "VEXA_OCR.docx");

  log("> Conversão concluída");
};

function copiarPix() {
  const input = document.getElementById("pixKey");
  input.select();
  document.execCommand("copy");
  document.getElementById("pixStatus").style.display = "block";
  setTimeout(() => {
    document.getElementById("pixStatus").style.display = "none";
  }, 3000);
}
</script>

</body>
</html>
